<html>
<head>
 <link href="../style.css" rel="stylesheet" type="text/css">
</head>
<body>
<h3>Шаблонизатор TWIG</h3>
<br/>
<p>Долгое время в NGCMS использовалась собственная шаблонная система. С одной стороны она давала некоторую гибкость при разработке шаблонов, с другой - лёгкость в реализации.
Основным же недостатком являлись крайне скудные возможности использования условных блоков, что приводило к созданию массы ненужных файлов-шаблонов и не позволяло проявить должную гибкость при создании
шаблонов, значительно отличающихся от "базового" шаблона.</p>
<br/>
<p>Все эти недостатки привели к необходимости найти альтертативу.
И она была найдена - <a href="http://twig.sensiolabs.org/doc/templates.html" target="_blank">компилирующий шаблонизатор TWIG</a>.</p>
<br/>
<p>TWIG объединяет в себе высокую производительность (каждый шаблон автоматически компилируется в чистый PHP код) и огромную гибкость. При этом ядро TWIG'а предусматривает широкие возможности по расширению
базового функционала и даже позволяет обеспечить (в определённых рамках) обратную совместимость с текущим (старым) шаблонизатором.</p>
<br/>
<p>Документацию по TWIG'у можно почитать на сайте разработчика, на этой же странице будет рассказано о глобальных переменных/функциях NGCMS, доступных в любых TWIG шаблонах.</p>
<br/><br/>

<h3>Использование шаблонизатора TWIG в шаблонах</h3>
В NGCMS существует 2 типа шаблонов:
<ul><li><font color="blue"><b>[T]</b></font> на базе TWIG - в этих шаблонах синтаксис TWIG можно использовать сразу</li></ul>
<ul><li>Обычные шаблоны - в них TWIG функции доступны внутри блока [TWIG] .. [/TWIG]</li></ul>
<br/>
<h3>Глобальные функции</h3>
<ul>
 <li><b>template_from_string(<font color="blue">$variable</font>)</b> - встроенная TWIG функция, позволяет исполнять TWIG шаблон из переменной/
 	<br/>
 	Пример использования, позволяет выполнить TWIG шаблон из переменной category.info (описание категории для режима работы "вывод новостей из категории") шаблона news.table.tpl:<br/>
 	<div class="pre">
 	<pre>
	{% if (handler == 'by.category') %}
		{% include template_from_string(category.info) %}
	{% endif %}
	</pre>
	</div>
 </li>
 <li><b>pluginIsActive(<font color="blue">$pluginName</font>)</b> - сообщает включен ли плагин <b>$pluginName</b> (1 - активен, 0 - нет), обычно используется для отображения элементов плагина только в том случае, если данный плагин включен (активен).
 	<br/>
 	Пример, выводящий строку '* плагин tags активен *' в случае, если плагин tags включен в админ-панели:<br/>
 	<div class="pre">
 	<pre>
 	{% if pluginIsActive('tags') %}
 		* плагин tags активен *
 	{% endif %}
	</pre>
	</div>
 </li>
 <li><b>localPath(0)</b> - возвращает путь нахождения текущего шаблона, содержимое блока отображается в случае, если для категории определена иконка. Используется в случае, когда вы внутри шаблона хотите подключить другой шаблон из того же каталога.<br/>
 <i>Параметр (0) - обязателен.</i><br/>
 Пример подключения шаблона "conf.navi.tpl" из текущего каталога:
 	<div class="pre">
 	<pre>
	{% include localPath(0) ~ "conf.navi.tpl" %}
	</pre>
	</div>
 </li>
 <li><b>getLang(0)</b> - возвращает текущий язык.<br/>
 <i>Параметр (0) - обязателен.</i><br/>
 </li>

 <li><b>isLang(<font color="blue">$lang</font>)</b> - возвращает <b>true</b> если текущий язык - $lang<br/>
 <i>Параметр ($lang) - обязателен.</i><br/>
 </li>

 <li><b>isHandler(<font color="blue">$rule</font>)</b> - возвращает <b>true</b> в случае, если текущее местоположение пользователя соотвествует указанным правилам в <b>$rule</b><br/>
 Формат переменной <b>$rule</b>: ENTRY1[|ENTRY2[|ENTRY3[...]]]</br>
 Формат записи ENTRYx: PLUGIN[:HANDLER]<br/>
 где:<br/>
 <b>PLUGIN</b> - ID плагина<br/>
 <b>HANDLER</b> - ID обработчика (если указан)<br/>
 	<div class="pre">
 	<pre>
 	{% if isHandler('tags|news:main') %}
 		* Пользователь находится на главной странице или на странице плагина tags *
 	{% endif %}
	</pre>
	</div>
 </li>

 <li><b>isCategory(<font color="blue">$list</font>)</b> - работа с текущей категорией посетителя (если он находится в категории)<br/>
 Функция <b>isCategory</b> поддерживает 2 режима работы:
 <ul>
  <li>Возвращает <b>true</b> в случае, если пользователь находится в одной из указанных в <b>$list</b> категориях.<br/>
  Список разделяется запятыми, в качестве элемента можно использовать как альт. имя так и ID категории.<br/>
 	<div class="pre">
 	<pre>
 	{% if isCategory('news,plugins,15') %}
 		* Пользователь находится в одной из категорий - с альт. именами 'news', 'plugin', либо с id 15 *
 	{% endif %}
	</pre>
	</div>

  </li>
  <li>Возвращает информацию о текущей категории (если пользователь сейчас в какой-либо категории).</br>
  Допустимые значения для параметра <b>$list</b>:
  <ul>
   <li><b>:id</b> - возвращает ID категории</li>
   <li><b>:alt</b> - возвращает альт. имя категории</li>
   <li><b>:name</b> - возвращает имя категории</li>
   <li><b>:icon</b> - возвращает <b>true</b> если у категории есть прикрепленная иконка (изображение)</li>
   <li><b>:icon.url</b> - возвращает URL прикрепленной иконки</li>
   <li><b>:icon.width</b> - возвращает ширину прикрепленной иконки</li>
   <li><b>:icon.height</b> - возвращает высоту прикрепленной иконки</li>
   <li><b>:icon.preview</b> - возвращает <b>true</b> если у прикрепленной иконки есть уменьшенное изображение (превьюшка)</li>
   <li><b>:icon.preview.url</b> - возвращает URL для превью прикрепленной иконки</li>
   <li><b>:icon.preview.width</b> - возвращает ширину для превью прикрепленной иконки</li>
   <li><b>:icon.preview.height</b> - возвращает высоту для превью прикрепленной иконки</li>
  </ul>

  </li>
 </ul>
 </li>
 <li><b>isNews(<font color="blue">$rule</font>)</b> - работа с текущей новостью посетителя (если он находится в новости).<br/>
 Формат переменной <b>$rule</b>: ENTRY1[|ENTRY2[|ENTRY3[...]]]</br>
 Формат записи ENTRYx: TYPE[:LIST] <i>или</i>LIST (в этом случае TYPE == news)<br/>
 где:<br/>
 <b>TYPE</b> - тип записи, доступные типы:<br/>
 <ul>
  <li><b>news</b> - новость (ID или альт. имя)</li>
  <li><b>cat</b> - категория (ID или альт. имя)</li>
  <li><b>mastercat</b> - главная категория (ID или альт. имя)</li>
 </ul>
 <b>LIST</b> - список значений через запятую<br/>
 	<div class="pre">
 	<pre>
 	{% if isNews('my_news,very_happy,15|mastercat:12,games') %}
 		* Пользователь находится в новости с: альт. именем "my_news" или "very_happy" или с ID 15 или главная категория новости имеет ID 12 или главная категория новости имеет альт. имя "games" *
 	{% endif %}
	</pre>
	</div>
 </li>
 <li><b>engineMSG(<font color="blue">$type</font>, <font color="blue">$text</font>, <font color="blue">$info</font>)</b> - выводит сообщение CMS в стиле текущего шаблона.<br/>
 где:<br/>
 <ul>
  <li><b>$type</b> - тип сообщения (common, error, info)</li>
  <li><b>$text</b> - текст сообщения</li>
  <li><b>$info</b> - дополнительная информация (необязательный параметр)</li>
 </ul>
 </li>
 <li><b>isSet(<font color="blue">$variable</font>)</b> - возвращает <b>true</b> если переменная с именем $variable определена.</li>
 <li><b>callPlugin(<font color="blue">$function, $variable</font>)</b> - вызывает функцию <b>$function</b> и передаёт ей параметр <b>$variable</b>.</li>
 <li><b>debugContext(<font color="blue">0</font>)</b> - выводит на экран отладочную информацию по всем доступным в данном месте переменным с их значениями.<br/><i>Использовать только для отладки !!</i></li>
 <li><b>debugValue(<font color="blue">$variable</font>)</b> - выводит на экран отладочную информацию по содержимому указанной переменной.<br/><i>Использовать только для отладки !!</i>
  	<div class="pre">
 	<pre>
	&lt;!-- Выводим все параметры глобальной переменной handler --&gt;
 	{{ debugValue(handler) }}
	</pre>
	</div>
</li>
 <li><b>getCategoryTree(<font color="blue">$filter</font>)</b> - выводит массив с деревом категорий в формате, описанном в шаблоне news.categories.tpl.<br/>
  где:<br/>
 <b>$filter</b> - фильтр выдаваемой информации:<br/>
 <ul>
  <li><b>не определён</b> - если переменная не определена (не передаётся в функцию), то выводится полное дерево категорий</li>
  <li><b><font color="blue">ID</font></b> - вывести категорию и всех её детей</li>
  <li><b>:<font color="blue">ID</font></b> - вывести всех детей заданной категории</li>
 </ul>

  	<div class="pre">
 	<pre>
	&lt;!-- Выводим всех детей категории с ID=6 --&gt;
	{% for entry in getCategoryTree(':6') %}
		[{{entry.id}}]({{ entry.level }}) {{ entry.cat }}
	{% endfor %}
	</pre>
	</div>
</li>


</ul>

<h3>Глобальные переменные</h3>
<ul>
 <li><b>lang</b> - глобальная переменная с языковыми константами, аналогична конструкции <b>{l_<font color="blue">Variable</font>}</b> в старом шаблонизаторе.
 	<br/>
 	Пример:
 	<div class="pre">
 	<pre>
 	{{ lang['Variable'] }}
	</pre>
	</div>
 </li>
 <li><b>skins_url</b> - аналог переменной <b>{skins_url}</b></li>
 <li><b>admin_url</b> - аналог переменной <b>{admin_url}</b></li>
 <li><b>tpl_url</b> - аналог переменной <b>{tpl_url}</b></li>
 <li><b>handler</b> - глобальная переменная <b>$CurrentHandler</b> (массив)</li>
 <li><b>global</b> - специальный массив с различными полезными <u>глобальными</u> параметрами:
 	<ul>
		<li><b>user</b> - структура с строчкой из таблицы ng_users залогиненного пользователя (<i>пример:</i> <b>global.user.name</b> - логин пользователя)
 		<li><b>flags</b> - массив с флагами:
 			<ul>
 				<li><b>isLogged</b> - принимает значение (1) если текущий посетитель - залогиенный пользователь</li>
			</ul>

		</li>
	</ul>

 </li>
</ul>

</body>
</html>