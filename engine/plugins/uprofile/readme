# =========================================================================== #
# NG CMS // РџР»Р°РіРёРЅС‹ // РџСЂРѕСЃРјРѕС‚СЂ/СЂРµРґР°РєС‚РёСЂРѕРІР°РЅРёРµ РїСЂРѕС„РёР»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ           #
# =========================================================================== #

РџР»Р°РіРёРЅ РѕР±РµСЃРїРµС‡РёРІР°РµС‚ С„СѓРЅРєС†РёРѕРЅР°Р» РїСЂРѕСЃРјРѕС‚СЂР° Рё СЂРµРґР°РєС‚РёСЂРѕРІР°РЅРёСЏ РїСЂРѕС„РёР»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№.
Р—Р° РґР°РЅРЅС‹Рµ С„СѓРЅРєС†РёРё РѕС‚РІРµС‡Р°СЋС‚ СЃР»РµРґСѓСЋС‰РёРµ С€Р°Р±Р»РѕРЅС‹:

users.tpl	- РїСЂРѕСЃРјРѕС‚СЂ РїСЂРѕС„РёР»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ (РєР°Рє С‡СѓР¶РѕРіРѕ С‚Р°Рє Рё СЃРІРѕРµРіРѕ)
profile.tpl	- СЃС‚СЂР°РЅРёС†Р° СЂРµРґР°РєС‚РёСЂРѕРІР°РЅРёСЏ СЃРѕР±СЃС‚РІРµРЅРЅРѕРіРѕ РїСЂРѕС„РёР»СЏ


[TWIG] users.tpl
------------------------------------------------
РЁР°Р±Р»РѕРЅ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РґР»СЏ РїСЂРѕСЃРјРѕС‚СЂР° РїСЂРѕС„РёР»СЏ Р»СЋР±РѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ (Р° С‚Р°РєР¶Рµ СЃРІРѕРµРіРѕ РІ
СЂРµР¶РёРјРµ "РєР°Рє РјРµРЅСЏ РІРёРґСЏС‚ РґСЂСѓРіРёРµ")

РќРµРєРѕС‚РѕСЂС‹Рµ РїРµСЂРµРјРµРЅРЅС‹Рµ РѕСЃС‚Р°РІР»РµРЅС‹ РІ С€Р°Р±Р»РѕРЅРµ РІ С†РµР»СЏС… СЃРѕРІРјРµСЃС‚РёРјРѕСЃС‚Рё СЃ РїСЂРµРґС‹РґСѓС‰РёРјРё РІРµСЂСЃРёСЏРјРё.

РЎРїРёСЃРѕРє РїРµСЂРµРјРµРЅРЅС‹С…:
* user		- РјР°СЃСЃРёРІ СЃ РґР°РЅРЅС‹РјРё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ, РІР·СЏС‚С‹РјРё РёР· С‚Р°Р±Р»РёС†С‹ Р‘Р” users
  * id		- ID РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * name	- Р»РѕРіРёРЅ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * news        - РєРѕР»-РІРѕ РЅРѕРІРѕСЃС‚РµР№ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * com		- РєРѕР»-РІРѕ РєРѕРјРјРµРЅС‚Р°СЂРёРµРІ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * status	- РЅР°РёРјРµРЅРѕРІР°РЅРёРµ РіСЂСѓРїРїС‹ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * last	- РґР°С‚Р°/РІСЂРµРјСЏ РїРѕСЃР»РµРґРЅРµРіРѕ РїРѕСЃРµС‰РµРЅРёСЏ
  * reg		- РґР°С‚Р°/РІСЂРµРјСЏ СЂРµРіРёСЃС‚СЂР°С†РёРё
  * site	- URL СЃР°Р№С‚Р°
  * icq		- РЅРѕРјРµСЂ ICQ
  * from	- РџРѕР»Рµ "РѕС‚РєСѓРґР°"
  * info	- РџРѕР»Рµ "РёРЅС„РѕСЂРјР°С†РёСЏ РѕР±Рѕ РјРЅРµ"
  * photo	- URL С„РѕС‚РѕРіСЂР°С„РёРё
  * photo_thumb - URL СѓРјРµРЅСЊС€РµРЅРЅРѕР№ РєРѕРїРёРё
  * flags	- РњР°СЃСЃРёРІ СЃ РїСЂРёР·РЅР°РєР°РјРё/С„Р»Р°РіР°РјРё
    * hasPhoto		- Р¤Р»Р°Рі: Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РµСЃС‚СЊ С„РѕС‚РѕРіСЂР°С„РёСЏ
    * hasAvatar		- Р¤Р»Р°Рі: Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РµСЃС‚СЊ Р°РІР°С‚Р°СЂРєР°
    * hasIcq		- Р¤Р»Р°Рі: Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РµСЃС‚СЊ ICQ
    * isOwnProfile	- Р¤Р»Р°Рі: РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РїСЂРѕСЃРјР°С‚СЂРёРІР°РµС‚ _СЃРѕР±СЃС‚РІРµРЅРЅС‹Р№_ РїСЂРѕС„РёР»СЊ
* token	- РўРѕРєРµРЅ Р±РµР·РѕРїР°СЃРЅРѕСЃС‚Рё РґР»СЏ РїРµСЂРµРґР°С‡Рё РІ RPC С„СѓРЅРєС†РёСЋ plugin.uprofile.editForm

HINT: РџРµСЂРµРјРµРЅРЅС‹Рµ РёР· РїР»Р°РіРёРЅР° xfields (РґРѕРї. РїРѕР»СЏ) РґРѕСЃС‚СѓРїРЅС‹ РІ РІРµС‚РєРµ p.xfields.
Р�РЅС‚РµСЂРµСЃСѓСЋС‰РёРµСЃСЏ РјРѕРіСѓС‚ РІС‹РїРѕР»РЅРёС‚СЊ {{ debugValue(p.xfields) }} Рё РїРѕСЃРјРѕС‚СЂРµС‚СЊ РєР°РєСѓСЋ РёРјРµРЅРЅРѕ РёРЅС„РѕСЂРјР°С†РёСЋ
РїСЂРµРґРѕСЃС‚Р°РІР»СЏРµС‚ xfields РІ РґР°РЅРЅС‹Р№ С€Р°Р±Р»РѕРЅ.

Р”Р»СЏ "РїРµСЂРµС…РѕРґР°" РёР· СЂРµР¶РёРјР° "РїСЂРѕСЃРјРѕС‚СЂР° СЃРѕР±СЃС‚РІРµРЅРЅРѕРіРѕ РїСЂРѕС„РёР»СЏ" РІ РµРіРѕ СЂРµРґР°РєС‚РёСЂРѕРІР°РЅРёРµ РјРѕР¶РЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ
СЃР»РµРґСѓСЋС‰СѓСЋ РєРѕРЅСЃС‚СЂСѓРєС†РёСЋ.
РќРµРѕР±С…РѕРґРёРјС‹Рµ РїСЂРµРґС‹РґСѓС‰РёРµ С€Р°РіРё:
* РІ С€Р°Р±Р»РѕРЅРµ СЃРѕР·РґР°РЅР° СЃСЃС‹Р»РєР° СЃ С‚РµРєСЃС‚РѕРј "СЂРµРґР°РєС‚РёСЂРѕРІР°С‚СЊ РїСЂРѕС„РёР»СЊ" Рё СЃРѕР±С‹С‚РёРµРј onclick = "ng_uprofile_editCall(); return false"
* РІСЃС‘ СЃРѕРґРµСЂР¶РёРјРѕРµ С€Р°Р±Р»РѕРЅР° users.tpl РїРѕРјРµС‰РµРЅРѕ РІ div СЃ ID "uprofileReplaceForm"

{% if (user.flags.isOwnProfile) %}
<script type="text/javascript" language="javascript">
function ng_uprofile_editCall() {
	$.post('/engine/rpc.php', { json : 1, methodName : 'plugin.uprofile.editForm', rndval: new Date().getTime(), params : json_encode({ 'token' : '{{ token }}' }) }, function(data) {
		// Try to decode incoming data
		try {
			resTX = eval('('+data+')');
		} catch (err) { alert('Error parsing JSON output. Result: '+linkTX.response); }
		if (!resTX['status']) {
			ngNotifyWindow('Error ['+resTX['errorCode']+']: '+resTX['errorText'], 'ERROR');
		} else {
			$('#uprofileReplaceForm').html(resTX['data']);
		}
	}).error(function() { ngNotifyWindow('HTTP error during request', 'ERROR'); });

}
</script>
{% endif %}



[TWIG] profile.tpl
------------------------------------------------
РЁР°Р±Р»РѕРЅ РґР»СЏ СЂРµРґР°РєС‚РёСЂРѕРІР°РЅРёСЏ СЃРѕР±СЃС‚РІРµРЅРЅРѕРіРѕ РїСЂРѕС„РёР»СЏ
РЁР°Р±Р»РѕРЅ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РґР»СЏ РїСЂРѕСЃРјРѕС‚СЂР° РїСЂРѕС„РёР»СЏ Р»СЋР±РѕРіРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ (Р° С‚Р°РєР¶Рµ СЃРІРѕРµРіРѕ РІ
СЂРµР¶РёРјРµ "РєР°Рє РјРµРЅСЏ РІРёРґСЏС‚ РґСЂСѓРіРёРµ")

* user		- РјР°СЃСЃРёРІ СЃ РґР°РЅРЅС‹РјРё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ, РІР·СЏС‚С‹РјРё РёР· С‚Р°Р±Р»РёС†С‹ Р‘Р” users
  * id		- ID РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * name	- Р»РѕРіРёРЅ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * news        - РєРѕР»-РІРѕ РЅРѕРІРѕСЃС‚РµР№ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * com		- РєРѕР»-РІРѕ РєРѕРјРјРµРЅС‚Р°СЂРёРµРІ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * status	- РЅР°РёРјРµРЅРѕРІР°РЅРёРµ РіСЂСѓРїРїС‹ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * last	- РґР°С‚Р°/РІСЂРµРјСЏ РїРѕСЃР»РµРґРЅРµРіРѕ РїРѕСЃРµС‰РµРЅРёСЏ
  * reg		- РґР°С‚Р°/РІСЂРµРјСЏ СЂРµРіРёСЃС‚СЂР°С†РёРё
  * email	- email РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ
  * site	- URL СЃР°Р№С‚Р°
  * icq		- РЅРѕРјРµСЂ ICQ
  * from	- РџРѕР»Рµ "РѕС‚РєСѓРґР°"
  * info	- РџРѕР»Рµ "РёРЅС„РѕСЂРјР°С†РёСЏ РѕР±Рѕ РјРЅРµ"
  * photo	- URL С„РѕС‚РѕРіСЂР°С„РёРё
  * photo_thumb - URL СѓРјРµРЅСЊС€РµРЅРЅРѕР№ РєРѕРїРёРё
  * flags	- РњР°СЃСЃРёРІ СЃ РїСЂРёР·РЅР°РєР°РјРё/С„Р»Р°РіР°РјРё
    * hasPhoto		- Р¤Р»Р°Рі: Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РµСЃС‚СЊ С„РѕС‚РѕРіСЂР°С„РёСЏ
    * hasAvatar		- Р¤Р»Р°Рі: Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РµСЃС‚СЊ Р°РІР°С‚Р°СЂРєР°
* flags		- РќР°Р±РѕСЂ РіР»РѕР±Р°Р»СЊРЅС‹С… С„Р»Р°РіРѕРІ
  * photoAllowed	- Р¤Р»Р°Рі: РїРѕР»СЊР·РѕРІР°С‚РµР»СЏРј СЂР°Р·СЂРµС€РµРЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ С„РѕС‚РѕРіСЂР°С„РёРё
  * avatarAllowed	- Р¤Р»Р°Рі: РїРѕР»СЊР·РѕРІР°С‚РµР»СЏРј СЂР°Р·СЂРµС€РµРЅРѕ РёРјРµС‚СЊ Р°РІР°С‚Р°СЂС‹
* info_sizelimit_text	- С‚РµРєСЃС‚РѕРІРѕРµ СЃРѕРѕР±С‰РµРЅРёРµ РґР»СЏ РІС‹РґР°С‡Рё РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ РїСЂРё РїСЂРµРІС‹С€РµРЅРёРё СЂР°Р·РјРµСЂР° РїРѕР»СЏ "РѕР±Рѕ РјРЅРµ" (info)
* info_sizelimit	- РѕРіСЂР°РЅРёС‡РµРЅРёРµ (РІ СЃРёРјРІРѕР»Р°С…) РЅР° РјР°РєСЃРёРјР°Р»СЊРЅС‹Р№ СЂР°Р·РјРµСЂ РїРѕР»СЏ "РѕР±Рѕ РјРЅРµ" (info)
* form_action		- URL С„РѕСЂРјС‹, РЅР° РєРѕС‚РѕСЂС‹Р№ РЅРµРѕР±С…РѕРґРёРјРѕ РѕС‚РїСЂР°РІР»СЏС‚СЊ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РґР»СЏ СЃРѕС…СЂР°РЅРµРЅРёСЏ РїСЂРѕС„РёР»СЏ
* token	- РўРѕРєРµРЅ Р±РµР·РѕРїР°СЃРЅРѕСЃС‚Рё РґР»СЏ РёР·РјРµРЅРµРЅРёСЏ РїСЂРѕС„РёР»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ


Р”Р»СЏ СЃРѕС…СЂР°РЅРµРЅРёСЏ РЅР°СЃС‚СЂРѕРµРє РїСЂРѕС„РёР»СЏ РЅРµРѕР±С…РѕРґРёРјРѕ СЃРѕР·РґР°С‚СЊ С„РѕСЂРјСѓ, РѕС‚РїСЂР°РІР»СЏСЋС‰СѓСЋ POST Р·Р°РїСЂРѕСЃ РЅР° URL {{ form_action }}.
РџСЂРё СЌС‚РѕРј РЅРµРѕР±С…РѕРґРёРјРѕ РґРѕР±Р°РІРёС‚СЊ СЃР»РµРґСѓСЋС‰РёРµ РЅРµРІРёРґРёРјС‹Рµ (hidden) РїРѕР»СЏ:
* token СЃРѕ Р·РЅР°С‡РµРЅРёРµРј {{ token }}

Р�РЅС„РѕСЂРјР°С†РёСЏ РїРµСЂРµРґР°С‘С‚СЃСЏ РІ СЃР»РµРґСѓСЋС‰РёС… РїРѕР»СЏС…:
* editemail	- РґР»СЏ {{ user.email }}
* editsite	- РґР»СЏ {{ user.site }}
* editicq	- РґР»СЏ {{ user.icq }}
* editfrom	- РґР»СЏ {{ user.from }}
* editabout	- РґР»СЏ {{ user.about }}
* editpassword	- РґР»СЏ Р·Р°РґР°РЅРёСЏ РЅРѕРІРѕРіРѕ РїР°СЂРѕР»СЏ
* oldpass	- РґР»СЏ СѓРєР°Р·Р°РЅРёСЏ СЃС‚Р°СЂРѕРіРѕ РїР°СЂРѕР»СЏ (С‚СЂРµР±СѓРµС‚СЃСЏ С‚РѕР»СЊРєРѕ РїСЂРё РїРѕРїС‹С‚РєРµ СЃРјРµРЅС‹ РїР°СЂРѕР»СЏ)
* newphoto	- С‚РёРї "file", РґР»СЏ Р·Р°Р»РёРІРєРё РЅРѕРІРѕР№ С„РѕС‚РѕРіСЂР°С„РёРё
* delphoto	- С‚РёРї "checkbox", РґР»СЏ РѕС‚РјРµС‚РєРё "СѓРґР°Р»РёС‚СЊ С„РѕС‚РѕРіСЂР°С„РёСЋ"
* newavatar	- С‚РёРї "file", РґР»СЏ Р·Р°Р»РёРІРєРё РЅРѕРІРѕР№ Р°РІР°С‚Р°СЂРєРё
* delavatar	- С‚РёРї "checkbox", РґР»СЏ РѕС‚РјРµС‚РєРё "СѓРґР°Р»РёС‚СЊ Р°РІР°С‚Р°СЂРєСѓ"


Р”Р»СЏ РІС‹РІРѕРґР° С„РѕС‚РѕРіСЂР°С„РёРё РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РјРѕР¶РЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ СЃР»РµРґСѓСЋС‰СѓСЋ РєРѕРЅСЃС‚СЂСѓРєС†РёСЋ:
{% if (flags.photoAllowed) %}
 <input type="file" name="newphoto" size="40" /><br />
 {% if (user.flags.hasPhoto) %}
  <a href="{{ user.photo }}" target="_blank">
   <img src="{{ user.photo_thumb }}" style="margin: 5px; border: 0px; alt=""/>
  </a><br/>
  <input type="checkbox" name="delphoto" id="delphoto" class="check" />&nbsp;
  <label for="delphoto">{{ lang.uprofile['delete'] }}</label>
 {% endif %}
{% else %}
  {{ lang.uprofile['photos_denied'] }}
{% endif %}

Р”Р»СЏ РІС‹РІРѕРґР° Р°РІР°С‚Р°СЂР° РјРѕР¶РЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ РєРѕРЅСЃС‚СЂСѓРєС†РёСЋ:
{% if (flags.avatarAllowed) %}
 <input type="file" name="newavatar" size="40" /><br />
 {% if (user.flags.hasAvatar) %}
  <img src="{{ user.avatar }}" style="margin: 5px; border: 0px; alt=""/><br/>
  <input type="checkbox" name="delavatar" id="delavatar" class="check" />&nbsp;
  <label for="delavatar">{{ lang.uprofile['delete'] }}</label>
 {% endif %}
{% else %}
 {{ lang.uprofile['avatars_denied'] }}
{% endif %}


