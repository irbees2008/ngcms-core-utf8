# =========================================================================== #
# NG CMS // РџР»Р°РіРёРЅС‹ // РљР°Р»РµРЅРґР°СЂСЊ                                              #
# =========================================================================== #

РџР»Р°РіРёРЅ "РєР°Р»РµРЅРґР°СЂСЊ" СЂРµР°Р»РёР·СѓРµС‚ СЃС‚Р°РЅРґР°СЂС‚РЅС‹Р№ РґР»СЏ РјРЅРѕРіРёС… CMS С„СѓРЅРєС†РёРѕРЅР°Р» -
РѕС‚РѕР±СЂР°Р¶РµРЅРёРµ РєР°Р»РµРЅРґР°СЂСЏ СЃ РѕС‚РјРµС‚РєРѕР№ Р·Р° РєР°РєРёРµ РґР°С‚С‹ Рё РєР°РєРѕРµ РєРѕР»-РІРѕ РЅРѕРІРѕСЃС‚РµР№ Р±С‹Р»Рѕ
РѕРїСѓР±Р»РёРєРѕРІР°РЅРѕ РЅР° СЃР°Р№С‚Рµ.

РџР»Р°РіРёРЅ РјРѕР¶РµС‚ СЂР°Р±РѕС‚Р°С‚СЊ РІ РґРІСѓС… СЂРµР¶РёРјР°С…:
* РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРёР№ Р·Р°РїСѓСЃРє [СЃС‚Р°СЂС‹Р№ РІР°СЂРёР°РЅС‚] - РєРѕРґ РїР»Р°РіРёРЅР° Рё РіРµРЅРµСЂР°С†РёСЏ РєР°Р»РµРЅРґР°СЂСЏ
  РїСЂРѕРёСЃС…РѕРґРёС‚ РєР°Р¶РґС‹Р№ СЂР°Р· РїСЂРё РіРµРЅРµСЂР°С†РёРё СЃС‚СЂР°РЅРёС†С‹ СЃР°Р№С‚Р°
* TWIG Р·Р°РїСѓСЃРє - РіРµРЅРµСЂР°С†РёСЏ РєР°Р»РµРЅРґР°СЂСЏ РїСЂРѕРёСЃС…РѕРґРёС‚ С‡РµСЂРµР· РІС‹Р·РѕРІ TWIG С„СѓРЅРєС†РёРё
  РёР· С€Р°Р±Р»РѕРЅР° СЃР°Р№С‚Р°. Р’ РґР°РЅРЅРѕРј СЂРµР¶РёРјРµ РІС‹ РјРѕР¶РµС‚Рµ РЅР° РѕРґРЅРѕР№ СЃС‚СЂР°РЅРёС†Рµ РѕС‚РѕР±СЂР°Р·РёС‚СЊ
  РЅРµСЃРєРѕР»СЊРєРѕ РЅРµР·Р°РІРёСЃРёРјС‹С… РєР°Р»РµРЅРґР°СЂРµР№ СЃРѕ СЃРІРѕРµР№ СЃРѕР±СЃС‚РІРµРЅРЅРѕР№ РёРЅС„РѕСЂРјР°С†РёРµР№ Рё РІРєР»СЋС‡Р°С‚СЊ
  РµРіРѕ С‚РѕР»СЊРєРѕ РїСЂРё РЅРµРѕР±С…РѕРґРёРјРѕСЃС‚Рё. Р­С‚Рѕ РїРѕР·РІРѕР»РёС‚ РЅРµРјРЅРѕРіРѕ СѓРјРµРЅСЊС€РёС‚СЊ РЅР°РіСЂСѓР·РєСѓ.

[[ Р•СЃС‚СЊ РІРѕР·РјРѕР¶РЅРѕСЃС‚СЊ "РїРµСЂРµРєР»СЋС‡Р°С‚СЊ" РєР°Р»РµРЅРґР°СЂСЊ Р±РµР· РѕР±РЅРѕРІР»РµРЅРёСЏ СЃС‚СЂР°РЅРёС†С‹, СЃРј. РЅРёР¶Рµ ]]


Р”Р»СЏ СЂР°Р±РѕС‚С‹ РїР»Р°РіРёРЅР° РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РµРґРёРЅС‹Р№ TWIG С€Р°Р±Р»РѕРЅ (РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ calendar.tpl).
РџСЂРё РіРµРЅРµСЂР°С†РёРё С€Р°Р±Р»РѕРЅР° РґРѕСЃС‚СѓРїРЅС‹ СЃР»РµРґСѓСЋС‰РёРµ РїРµСЂРµРјРµРЅРЅС‹Рµ:

* currentMonth	- РјР°СЃСЃРёРІ СЃ РґР°РЅРЅС‹РјРё Рѕ С‚РµРєСѓС‰РµРј РІС‹Р±СЂР°РЅРЅРѕРј РјРµСЃСЏС†Рµ
  * name		- РЅР°Р·РІР°РЅРёРµ РјРµСЃСЏС†Р°
  * link		- СЃСЃС‹Р»РєР° РЅР° СЃС‚СЂР°РЅРёС†Сѓ СЃР°Р№С‚Р° СЃ РѕС‚РѕР±СЂР°Р¶РµРЅРёРµРј РЅРѕРІРѕСЃС‚РµР№ Р·Р° РґР°РЅРЅС‹Р№ РјРµСЃСЏС†
* currentEntry	- РґР°РЅРЅС‹Рµ Рѕ С‚РµРєСѓС‰РµРј Р·Р°РїСѓСЃРєРµ РїР»Р°РіРёРЅР°
  * month		- РЅРѕРјРµСЂ РјРµСЃСЏС†Р°
  * year		- РіРѕРґ
  * template	- РёСЃРїРѕР»СЊР·СѓРµРјС‹Р№ С€Р°Р±Р»РѕРЅ
  * categories	- СЃРїРёСЃРѕРє РєР°С‚РµРіРѕСЂРёР№, РїРѕ РєРѕС‚РѕСЂС‹Рј РіРµРЅРµСЂРёСЂСѓРµС‚СЃСЏ РєР°Р»РµРЅРґР°СЂСЊ
* prevMonth		- РјР°СЃСЃРёРІ СЃ РґР°РЅРЅС‹РјРё Рѕ "РїСЂРµРґС‹РґСѓС‰РµРј" РјРµСЃСЏС†Рµ
  * link		- СЃСЃС‹Р»РєР° РЅР° СЃС‚СЂР°РЅРёС†Сѓ СЃР°Р№С‚Р° СЃ РѕС‚РѕР±СЂР°Р¶РµРЅРёРµРј РЅРѕРІРѕСЃС‚РµР№ Р·Р° РїСЂРµРґС‹РґСѓС‰РёР№ РјРµСЃСЏС†
* nextMonth		- РјР°СЃСЃРёРІ СЃ РґР°РЅРЅС‹РјРё Рѕ "СЃР»РµРґСѓСЋС‰РµРј" РјРµСЃСЏС†Рµ
  * link		- СЃСЃС‹Р»РєР° РЅР° СЃС‚СЂР°РЅРёС†Сѓ СЃР°Р№С‚Р° СЃ РѕС‚РѕР±СЂР°Р¶РµРЅРёРµРј РЅРѕРІРѕСЃС‚РµР№ Р·Р° СЃР»РµРґСѓСЋС‰РёР№ РјРµСЃСЏС†

* flags			- РјР°СЃСЃРёРІ СЃ С„Р»Р°РіР°РјРё
  * havePrevMonth	- РїСЂРёР·РЅР°Рє РІРѕР·РјРѕР¶РЅРѕСЃС‚Рё РїСЂРѕСЃРјРѕС‚СЂР° "РїСЂРµРґС‹РґСѓС‰РµРіРѕ" РјРµСЃСЏС†Р°
  * haveNextMonth	- РїСЂРёР·РЅР°Рє РІРѕР·РјРѕР¶РЅРѕСЃС‚Рё РїСЂРѕСЃРјРѕС‚СЂР° "СЃР»РµРґСѓСЋС‰РµРіРѕ" РјРµСЃСЏС†Р°
  * ajax			- РїСЂРёР·РЅР°Рє С‚РѕРіРѕ, С‡С‚Рѕ С€Р°Р±Р»РѕРЅ РіРµРЅРµСЂРёСЂСѓРµС‚СЃСЏ С‡РµСЂРµР· AJAX РІС‹Р·РѕРІ

* weekdays		- РјР°СЃСЃРёРІ СЃ РєРѕСЂРѕС‚РєРёРјРё РёРјРµРЅР°РјРё РґРЅРµР№ РЅРµРґРµР»Рё [РѕС‚ 0 (РІРѕСЃРєСЂРµСЃРµРЅСЊРµ) РґРѕ 6 (РџСЏС‚РЅРёС†Р°)]
* weeks			- РѕСЃРЅРѕРІРЅРѕР№ РјР°СЃСЃРёРІ СЃ РїРѕРЅРµРґРµР»СЊРЅС‹Рј РєР°Р»РµРЅРґР°СЂС‘Рј.
  * 1			- РїРµСЂРІР°СЏ РЅРµРґРµР»СЏ
    * 1			- РїРµСЂРІС‹Р№ РґРµРЅСЊ РЅРµРґРµР»Рё
      * dayNo		- РєР°Р»РµРЅРґР°СЂРЅС‹Р№ РЅРѕРјРµСЂ РґРЅСЏ [[ РµСЃР»Рё РЅРµ Р·Р°РїРѕР»РЅРµРЅ, С‚Рѕ РїРѕ РґР°РЅРЅРѕРјСѓ РґРЅСЋ РЅРµРґРµР»Рё РЅРµС‚ РєР°Р»РµРЅРґР°СЂРЅРѕРіРѕ РґРЅСЏ ]]
      			  	  Рє РїСЂРёРјРµСЂСѓ, РµСЃР»Рё РјРµСЃСЏС† РЅР°С‡РёРЅР°РµС‚СЃСЏ СЃРѕ СЃСЂРµРґС‹, С‚Рѕ Р·Р° РїРѕРЅРµРґРµР»СЊРЅРёРє-РІС‚РѕСЂРЅРёРє РґР°РЅРЅС‹С… РЅРµ Р±СѓРґРµС‚
      * countNews	- РєРѕР»-РІРѕ РЅРѕРІРѕСЃС‚РµР№ Р·Р° РґР°РЅРЅС‹Р№ РґРµРЅСЊ
      * className	- РёРјСЏ CSS РєР»Р°СЃСЃР°, РІРѕР·РјРѕР¶РЅС‹Рµ РІР°СЂРёР°РЅС‚С‹: "calendar_class_weekday", "calendar_class_weekend",
      				  "calendar_class_today_weekday", "calendar_class_today_weekend"
      * link		- СЃСЃС‹Р»РєР° РЅР° СЃС‚СЂР°РЅРёС†Сѓ СЃР°Р№С‚Р° СЃ РѕС‚РѕР±СЂР°Р¶РµРЅРёРµРј РЅРѕРІРѕСЃС‚РµР№ Р·Р° Р·Р°РґР°РЅРЅС‹Р№ РґРµРЅСЊ
      * isToday		- Р¤Р›РђР“: true, РµСЃР»Рё СЌС‚Рѕ _СЃРµРіРѕРґРЅСЏС€РЅРёР№_ РґРµРЅСЊ
      * isWeekDay 	- Р¤Р›РђР“: true, РµСЃР»Рё СЌС‚Рѕ СЂР°Р±РѕС‡РёР№ РґРµРЅСЊ (РџРќ-РџРў)
      * isWeekEnd	- Р¤Р›РђР“: true, РµСЃР»Рё СЌС‚Рѕ РІС‹С…РѕРґРЅРѕР№ (РЎР‘-Р’РЎ)

РўР°РєР¶Рµ РґРѕСЃС‚СѓРїРЅС‹ РіР»РѕР±Р°Р»СЊРЅС‹Рµ РїРµСЂРµРјРµРЅРЅС‹Рµ:
* tpl_url	- URL С€Р°Р±Р»РѕРЅРѕРІ СЃР°Р№С‚Р°
* lang		- РјР°СЃСЃРёРІ СЃ СЏР·С‹РєРѕРІС‹РјРё РїРµСЂРµРјРµРЅРЅС‹РјРё


================================================================================
Р’Р°СЂРёР°РЅС‚С‹ РёСЃРїРѕР»СЊР·РѕРІР°РЅРёСЏ РїР»Р°РіРёРЅР° РІ С€Р°Р±Р»РѕРЅР°С…
================================================================================
1. РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРёР№ Р·Р°РїСѓСЃРє.
Р’ С€Р°Р±Р»РѕРЅРµ main.tpl Р±СѓРґРµС‚ РґРѕСЃС‚СѓРїРЅР° РїРµСЂРµРјРµРЅРЅР°СЏ {plugin_calendar} СЃ РІС‹РІРѕРґРѕРј Р±Р»РѕРєР° РєР°Р»РµРЅРґР°СЂСЏ
2. TWIG
Р’ Р»СЋР±РѕРј С€Р°Р±Р»РѕРЅРµ РјРѕР¶РЅРѕ Р·Р°РїСѓСЃС‚РёС‚СЊ РіРµРЅРµСЂР°С†РёСЋ РєР°Р»РµРЅРґР°СЂСЏ РїСЂРё РїРѕРјРѕС‰Рё  TWIG С„СѓРЅРєС†РёРё callPlugin()

РџСЂРёРјРµСЂ (РґР»СЏ TWIG С€Р°Р±Р»РѕРЅР°):
{{ callPlugin('calendar.show', {'cache': 60 }) }}

РџСЂРёРјРµСЂ (РґР»СЏ Р»СЋР±РѕРіРѕ РЅРµ-TWIG С€Р°Р±Р»РѕРЅР°, Рє РїСЂРёРјРµСЂСѓ, РґР»СЏ main.tpl):
[TWIG]{{ callPlugin('calendar.show', {'cache': 60 }) }}[/TWIG]

Р”РѕСЃС‚СѓРїРЅС‹Рµ РїРµСЂРµРјРµРЅРЅС‹Рµ (РїРµСЂРµРґР°СЋС‚СЃСЏ РІ РєР°С‡РµСЃС‚РІРµ РјРµСЃСЃРёРІР° РїР°СЂР°РјРµС‚СЂРѕРІ РїРѕСЃР»Рµ РёРјРµРЅРё 'calendar.show':
* year		- РіРѕРґ
* month		- РјРµСЃСЏС†
* offset	- "СЃРјРµС‰РµРЅРёРµ" РѕС‚РЅРѕСЃРёС‚РµР»СЊРЅРѕ СѓРєР°Р·Р°РЅРЅРѕРіРѕ РіРѕРґР° Рё РјРµСЃСЏС†Р°.
			  РјРѕР¶РµС‚ РїСЂРёРЅРёРјР°С‚СЊ Р·РЅР°С‡РµРЅРёСЏ "prev" (РїРѕРєР°Р·Р°С‚СЊ РїСЂРµРґС‹РґСѓС‰РёР№) Рё "next"
			  (РїРѕРєР°Р·Р°С‚СЊ СЃР»РµРґСѓСЋС‰РёР№) РјРµСЃСЏС†
* template	- РёРјСЏ С€Р°Р±Р»РѕРЅР°
* category	- СЃРїРёСЃРѕРє РєР°С‚РµРіРѕСЂРёР№ РїРѕ РєРѕС‚РѕСЂС‹Рј РіРµРЅРµСЂРёСЂСѓРµС‚СЃСЏ РєР°Р»РµРЅРґР°СЂСЊ (РµСЃР»Рё РЅРµ СѓРєР°Р·С‹РІР°С‚СЊ, С‚Рѕ РёР· РІСЃРµС…)
* cache		- СЃСЂРѕРє Р¶РёР·РЅРё РєРµС€Р° (РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ = 0)


================================================================================
РџРµСЂРµРєР»СЋС‡РµРЅРёРµ СЃС‚СЂР°РЅРёС† РєР°Р»РµРЅРґР°СЂСЏ Р±РµР· РѕР±РЅРѕРІР»РµРЅРёСЏ СЃС‚СЂР°РЅРёС†С‹ СЃР°Р№С‚Р°.
================================================================================

Р”Р°РЅРЅР°СЏ РІРѕР·РјРѕР¶РЅРѕСЃС‚СЊ РґРѕСЃС‚СѓРїРЅР° Р±Р»Р°РіРѕРґР°СЂСЏ РЅР°Р»РёС‡РёСЋ AJAX/RPC С„СѓРЅРєС†РёРё plugin.calendar.show
Р¤СѓРЅРєС†РёСЏ РїСЂРёРЅРёРјР°РµС‚ РЅР° РІС…РѕРґ СЃР»РµРґСѓСЋС‰РёРµ РїР°СЂР°РјРµС‚СЂС‹:
* year		- РіРѕРґ
* month		- РјРµСЃСЏС†
* offset	- "СЃРјРµС‰РµРЅРёРµ" РѕС‚РЅРѕСЃРёС‚РµР»СЊРЅРѕ СѓРєР°Р·Р°РЅРЅРѕРіРѕ РіРѕРґР° Рё РјРµСЃСЏС†Р°.
			  РјРѕР¶РµС‚ РїСЂРёРЅРёРјР°С‚СЊ Р·РЅР°С‡РµРЅРёСЏ "prev" (РїРѕРєР°Р·Р°С‚СЊ РїСЂРµРґС‹РґСѓС‰РёР№) Рё "next"
			  (РїРѕРєР°Р·Р°С‚СЊ СЃР»РµРґСѓСЋС‰РёР№) РјРµСЃСЏС†


РџСЂРёРјРµСЂ JScript'Р° РґР»СЏ РїРµСЂРµРєР»СЋС‡РµРЅРёСЏ РјРµР¶РґСѓ РјРµСЃСЏС†Р°РјРё:

function ng_calendar_walk(month, year, offset) {
	// Р’С‹Р·РѕРІ AJAX/RPC РјРµС‚РѕРґР° 'plugin.calendar.show'
	$.post('/engine/rpc.php', { json : 1, methodName : 'plugin.calendar.show', rndval: new Date().getTime(), params : json_encode({ 'year' : year, 'offset' : offset, 'month' : month }) }, function(data) {
		// Р’ РєР°С‡РµСЃС‚РІРµ СЂРµР·СѓР»СЊС‚Р°С‚Р° РЅР°Рј РїРµСЂРµРґР°С‘С‚СЃСЏ JSON РјР°СЃСЃРёРІ РґР°РЅРЅС‹С….
		// РљР»СЋС‡РµРІС‹Рµ РїРѕР»СЏ:
		// * status - 1 (СѓСЃРїРµС€РЅРѕРµ РІС‹РїРѕР»РЅРµРЅРёРµ), 0 - РѕС€РёР±РєР°
		// * data - Р±Р»РѕРє РґР°РЅРЅС‹С… СЃ СЃРіРµРЅРµСЂРёСЂРѕРІР°РЅРЅС‹Рј РєР°Р»РµРЅРґР°СЂС‘Рј
		try {
			resTX = eval('('+data+')');
		} catch (err) { alert('Error parsing JSON output. Result: '+linkTX.response); }
		if (!resTX['status']) {
			ngNotifyWindow('Error ['+resTX['errorCode']+']: '+resTX['errorText'], 'ERROR');
		} else {
			// Р—Р°РјРµРЅСЏРµРј СЃРѕРґРµСЂР¶РёРјРѕРµ DIV СЃ ID = "ngCalendarDIV" РЅРѕРІС‹РјРё РґР°РЅРЅС‹РјРё
			$('#ngCalendarDiv').html(resTX['data']);
		}
	}, "text").error(function() { ngHideLoading(); ngNotifyWindow('HTTP error during request', 'ERROR'); });

}

