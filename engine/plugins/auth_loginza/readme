# =========================================================================== #
# NG CMS // РџР»Р°РіРёРЅС‹ // auth_loginza - Р°РІС‚РѕСЂРёР·Р°С†РёСЏ С‡РµСЂРµР· OpenID/oAuth/OpenAPI  #
# =========================================================================== #

РџР»Р°РіРёРЅ РЅРµ СЏРІР»СЏРµС‚СЃСЏ СЃР°РјРѕСЃС‚РѕСЏС‚РµР»СЊРЅС‹Рј РјРѕРґСѓР»РµРј Р°РІС‚РѕСЂРёР·Р°С†РёРё, Р° СЂР°Р±РѕС‚Р°РµС‚ Р»РёС€СЊ, РєР°Рє 
РґРѕРїРѕР»РЅРµРЅРёРµ Рє РѕРґРЅРѕРјСѓ РёР· СѓР¶Рµ СЂР°Р±РѕС‚Р°СЋС‰РёС… РїР»Р°РіРёРЅРѕРІ, РЅР°РїСЂРёРјРµСЂ auth_basic.

# СЌС‚Рѕ С‚РµРєСЃС‚РѕРІР°СЏ РёРЅСЃС‚СЂСѓРєС†РёСЏ
# РїРѕР»РЅСѓСЋ РІРµСЂСЃРёСЋ РІ РєР°СЂС‚РёРЅРєР°С… СЃРј. РЅР° http://digitalplace.ru/webdev/plugin-loginza-ngcms.html

1. Р’ РїРµСЂРІСѓСЋ РѕС‡РµСЂРµРґСЊ РЅРµРѕР±С…РѕРґРёРјРѕ РІ \templates\%РІР°С€_С€Р°Р±Р»РѕРЅ%\usermenu.tpl РїРѕРґРєР»СЋС‡РёС‚СЊ
JavaScript РІРёРґР¶РµС‚: 

&lt;script src=&quot;http://loginza.ru/js/widget.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;

Р’ СЌС‚РѕРј Р¶Рµ С„Р°Р№Р»Рµ РЅРµРѕР±С…РѕРґРёРјРѕ СЂР°Р·РјРµСЃС‚РёС‚СЊ СЃСЃС‹Р»РєСѓ, РїСЂРё РЅР°Р¶Р°С‚РёРё РЅР° РєРѕС‚РѕСЂСѓСЋ Р±СѓРґРµС‚
РІСЃРїР»С‹РІР°С‚СЊ РѕРєРѕС€РєРѕ СЃ РЅР°Р±РѕСЂРѕРј РїСЂРѕРІР°Р№РґРµСЂРѕРІ РґР»СЏ Р°РІС‚РѕСЂРёР·Р°С†РёРё, РЅР°РїСЂРёРјРµСЂ:

&lt;a href=&quot;http://loginza.ru/api/widget?token_url=[RETURN_URL]&quot; class=&quot;loginza&quot;&gt;
&lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/sign_in_button_gray.gif&quot; alt=&quot;Р’РѕР№С‚Рё С‡РµСЂРµР· loginza&quot;/&gt;
&lt;/a&gt;

RETURN_URL - СЌС‚Рѕ СЃСЃС‹Р»РєР° С‚Р°РєРѕРіРѕ С‚РёРїР° http://РІР°С€_РґРѕРјРµРЅ.СЂСѓ/plugin/auth_loginza/

Р•СЃР»Рё РІС‹ РЅРµ С…РѕС‚РёС‚Рµ РІС‹РІРѕРґРёС‚СЊ РІСЃРµС… РїСЂРѕРІР°Р№РґРµСЂРѕРІ, Р° С‚РѕР»СЊРєРѕ РёР·Р±СЂР°РЅРЅС‹С…, С‚Рѕ РЅР° РїРѕРјРѕС‰СЊ РїСЂРёС…РѕРґРёС‚ РїР°СЂР°РјРµС‚СЂ 
providers_set (РµСЃР»Рё РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РЅРµСЃРєРѕР»СЊРєРѕ Р·РЅР°С‡РµРЅРёР№, РїРµСЂРµС‡РёСЃР»РёС‚Рµ РёС… С‡РµСЂРµР· Р·СЏРїСЏС‚СѓСЋ):
google, yandex, mailruapi, mailru, vkontakte, facebook, twitter, loginza, myopenid, webmoney, 
rambler, flickr, lastfm, verisign, aol, steam, openid.

РЎСЃС‹Р»РєР° РІС‹С€Рµ Р±СѓРґРµС‚ РІС‹РіР»СЏРґРµС‚СЊ РєР°Рє http://loginza.ru/api/widget?token_url=http://РІР°С€_РґРѕРјРµРЅ.СЂСѓ/plugin/auth_loginza/&amp;providers_set=vkontakte,twitter,google,yandex,mailru,facebook,openid

РўР°РєР¶Рµ РІРёРґР¶РµС‚ РјСѓР»СЊС‚РёСЏР·С‹С‡РЅС‹Р№: РїРѕРґРґРµСЂР¶РёРІР°РµС‚СЃСЏ С‚СЂРё СЏР·С‹РєР° СЂСѓСЃСЃРєРёР№ - ru, СѓРєСЂР°РёРЅСЃРєРёР№ - uk Рё Р°РЅРіР»РёР№СЃРєРёР№ - en.
Р�СЃРїРѕР»СЊР·РѕРІР°С‚СЊ РїРѕ Р°РЅР°Р»РѕРіРёРё http://loginza.ru/api/widget?token_url=http://РІР°С€_РґРѕРјРµРЅ.СЂСѓ/plugin/auth_loginza/&amp;lang=ru

Р’СЃРµ СЌС‚Рѕ, СЃР»РµРґСѓСЏ Р»РѕРіРёРєРµ, РЅСѓР¶РЅРѕ СЂР°Р·РјРµС‰Р°С‚СЊ РІ Р±Р»РѕРєРµ [login][/login], РєРѕС‚РѕСЂС‹Р№ РѕС‚РѕР±СЂР°Р¶Р°РµС‚СЃСЏ
С‚РѕР»СЊРєРѕ РґР»СЏ РЅРµР·Р°СЂРµРіРёСЃС‚СЂРёСЂРѕРІР°РЅРЅС‹С… РїРѕСЃРµС‚РёС‚РµР»РµР№.

РўСѓС‚ РІРѕР·РЅРёРєР°РµС‚ СЃР°РјС‹Р№ РїРµСЂРІС‹Р№ РІРѕРїСЂРѕСЃ, Р° РЅРµ РіРµРЅРµСЂРёСЂРѕРІР°С‚СЊ Р»Рё СЌС‚Сѓ СЃСЃС‹Р»РєСѓ СЃР°РјРѕРјСѓ, С‡С‚РѕР±С‹ РІ usermenu.tpl РјРѕР¶РЅРѕ 
Р±С‹Р»Рѕ РїСЂРѕСЃС‚Рѕ РІСЃС‚Р°РІРёС‚СЊ РїРµСЂРµРјРµРЅРЅСѓСЋ loginza_link? РќРѕ РїР»Р°РіРёРЅ РІРѕРѕР±С‰Рµ С…РѕСЂРѕС€ С‚РµРј, С‡С‚Рѕ РІСЃС‚Р°РІРёС‚СЊ СЃСЃС‹Р»РєСѓ РјРѕР¶РЅРѕ РІ Р»СЋР±РѕРµ РјРµСЃС‚Рѕ,
РЅР°РїСЂРёРјРµСЂ РІ РєРѕРјРјРµРЅС‚Р°СЂРёРё С‚Р°РєРёРј РѕР±СЂР°Р·РѕРј: (РґР° Рё РІРѕРѕР±С‰Рµ РІ Р»СЋР±РѕРµ РјРµСЃС‚Рѕ, С…РѕС‚СЊ РІ news.short.tpl)

РІ \templates\%РІР°С€_С€Р°Р±Р»РѕРЅ%\plugins\comments\comments.form.tpl РІСЃС‚Р°РІРёС‚СЊ Р±Р»РѕРє

[isnt-logged]
&lt;script src=&quot;http://loginza.ru/js/widget.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
РўР°РєР¶Рµ Р’С‹ РјРѕР¶РµС‚Рµ РІРѕР№С‚Рё РёСЃРїРѕР»СЊР·СѓСЏ:
&lt;a href=&quot;https://loginza.ru/api/widget?token_url=[RETURN_URL]&quot; class=&quot;loginza&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/yandex.png&quot; alt=&quot;Yandex&quot; title=&quot;Yandex&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/google.png&quot; alt=&quot;Google&quot; title=&quot;Google Accounts&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/vkontakte.png&quot; alt=&quot;Р’РєРѕРЅС‚Р°РєС‚Рµ&quot; title=&quot;Р’РєРѕРЅС‚Р°РєС‚Рµ&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/mailru.png&quot; alt=&quot;Mail.ru&quot; title=&quot;Mail.ru&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/twitter.png&quot; alt=&quot;Twitter&quot; title=&quot;Twitter&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/loginza.png&quot; alt=&quot;Loginza&quot; title=&quot;Loginza&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/myopenid.png&quot; alt=&quot;MyOpenID&quot; title=&quot;MyOpenID&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/openid.png&quot; alt=&quot;OpenID&quot; title=&quot;OpenID&quot;&gt;
    &lt;img src=&quot;/engine/plugins/auth_loginza/tpl/img/webmoney.png&quot; alt=&quot;WebMoney&quot; title=&quot;WebMoney&quot;&gt;
&lt;/a&gt;
[/isnt-logged]

РќСѓ РёР»Рё РІ login.tpl РёР»Рё registration.tpl РІСЃС‚Р°РІРёС‚СЊ

&lt;iframe src=&quot;http://loginza.ru/api/widget?overlay=loginza&amp;token_url=[RETURN_URL]&quot; 
style=&quot;width:359px;height:300px;&quot; scrolling=&quot;no&quot; frameborder=&quot;no&quot;&gt;&lt;/iframe&gt;

Р’Р°СЂРёР°РЅС‚РѕРІ РјР°СЃСЃР°.

2. Р”Р°Р»РµРµ РїСЂРё РЅР°Р¶Р°С‚РёРё РЅР° СЃСЃС‹Р»РєСѓ РѕС‚РєСЂС‹РІР°РµС‚СЃСЏ РѕРєРЅРѕ РІС‹Р±РѕСЂР° РїСЂРѕРІР°Р№РґРµСЂР°. РњС‹ РІС‹Р±РёСЂР°РµРј РѕРґРЅРѕРіРѕ РёР· РїСЂРµРґР»РѕР¶РµРЅРЅС‹С…,
Р›РѕРіРёРЅР·Р° РѕС‚РїСЂР°РІР»СЏРµС‚ РЅР°СЃ РЅР° РµРіРѕ СЃР°Р№С‚, С‚Р°Рј РјС‹ РїРѕРґС‚РІРµСЂР¶РґР°РµРј С‡С‚Рѕ РјС‹ СЌС‚Рѕ РјС‹ Рё РІ СЂРµР·СѓР»СЊС‚Р°С‚Рµ РЅР°Рј РїСЂРёС…РѕРґСЏС‚
РґР°РЅРЅС‹Рµ Рѕ РїРѕР»СЊР·РѕРІР°С‚РµР»Рµ. РўСѓС‚ РЅР°С‡РёРЅР°РµС‚СЃСЏ СЃР°РјРѕРµ РёРЅС‚РµСЂРµСЃРЅРѕРµ.

3. РџСЂРё СѓСЃС‚Р°РЅРѕРІРєРµ РїР»Р°РіРёРЅ РґРѕР±Р°РІР»СЏРµС‚ РІ С‚Р°Р±Р»РёС†Сѓ *_users СЃРІРѕРµ РїРѕР»Рµ, РІ РєРѕС‚РѕСЂРѕРј С…СЂР°РЅРёС‚ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ
РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ. Р•СЃР»Рё РїСЂРёСЃС‹Р»Р°РµРјС‹Р№ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ СѓР¶Рµ РїСЂРёРІСЏР·Р°РЅ Рє РєР°РєРѕРјСѓ-С‚Рѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ, С‚Рѕ РјС‹ 
Р±РµР· РІРѕРїСЂРѕСЃРѕРІ РµРіРѕ Р°РІС‚РѕСЂРёР·СѓРµРј.

Р•СЃР»Рё РЅРµС‚, С‚Рѕ РјС‹ РїРѕРєР°Р·С‹РІР°РµРј РµРјСѓ СѓРїСЂРѕС‰РµРЅРЅСѓСЋ С„РѕСЂРјСѓ СЂРµРіРёСЃС‚СЂР°С†РёРё. 

Р—Р°С‡РµРј РІРѕРѕР±С‰Рµ РЅСѓР¶РЅР° С„РѕСЂРјР° СЂРµРіРёСЃС‚СЂР°С†РёРё? Р›РёС‡РЅРѕ РјРµРЅСЏ РґРёРєРѕ СЂР°Р·РґСЂР°Р¶Р°РµС‚, РєРѕРіРґР° СЃР°Р№С‚ РіРµРЅРµСЂРёСЂСѓРµС‚
РЅРёРєРЅРµР№Рј Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РЅР° РѕСЃРЅРѕРІРµ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂР° Рё РЅРµ РґР°РµС‚ РІС‹Р±СЂР°С‚СЊ РµРіРѕ СЃР°РјРѕСЃС‚РѕСЏС‚РµР»СЊРЅРѕ.
РќР°РїСЂРёРјРµСЂ zhukov-alexey-open-id. Рђ РµСЃР»Рё РІР·СЏС‚СЊ Р“СѓРіР»РѕРІcРєРёР№ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ, С‚Рѕ С‚Р°Рј РІРѕРѕР±С‰Рµ 
С‚РµРјРЅС‹Р№ Р»РµСЃ РёР· 30 СЃРёРјРІРѕР»РѕРІ РЅРµС‡РёС‚Р°РµРјРѕРіРѕ С„РѕСЂРјР°С‚Р°.

РџРѕСЌС‚РѕРјСѓ РїР»Р°РіРёРЅ РїРѕРґР±РёСЂР°РµС‚ РЅРёРєРЅРµР№Рј РЅР° РѕСЃРЅРѕРІРµ РѕРїСЂРµРґРµР»РµРЅРЅС‹С… РґР°РЅРЅС‹С…, РЅРѕ РґР°РµС‚ РµРіРѕ РѕС‚РєРѕСЂСЂРµРєС‚РёСЂРѕРІР°С‚СЊ.
РўР°РєР¶Рµ СЃРѕР·РґР°РµРј РїСЂРѕРёР·РІРѕР»СЊРЅС‹Р№ РїР°СЂРѕР»СЊ, СЃРѕС…СЂР°РЅСЏСЏ РІРѕР·РјРѕР¶РЅРѕСЃС‚СЊ РґР»СЏ РІС…РѕРґР°, РёСЃРїРѕР»СЊР·СѓСЏ СЃС‚Р°РЅРґР°СЂС‚РЅСѓСЋ РїР°СЂСѓ 
Р»РѕРіРёРЅ/РїР°СЂРѕР»СЊ. Р� РµСЃР»Рё РїСЂРѕРІР°Р№РґРµСЂ РЅРµ РѕС‚РґР°Р» email С‚Р°РєР¶Рµ РїСЂРµРґР»Р°РіР°РµРј РµРіРѕ РІРІРµСЃС‚Рё, РЅРѕ СЌС‚Рѕ СЃРѕРІРµСЂС€РµРЅРЅРѕ
РЅРµ РѕР±СЏР·Р°С‚РµР»СЊРЅРѕ. РџРѕ РєСЂР°Р№РЅРµР№ РјРµСЂРµ РїРѕРєР°.

#=================================================#
Р�РЅС‚РµРіСЂР°С†РёСЏ СЃ РєРѕРјРјРµРЅС‚Р°СЂРёСЏРјРё СЃР°Р№С‚Р° (РїР»Р°РіРёРЅ  comments)
#=================================================#

Р”Р»СЏ С‚РµС… СѓС‡РµС‚РЅС‹С… Р·Р°РїРёСЃРµР№, Сѓ РєРѕС‚РѕСЂС‹С… РµСЃС‚СЊ РїСЂРёРІСЏР·РєР° РїСЂРѕС„РёР»СЏ Рє РѕРґРЅРѕРјСѓ РёР· СЃРµСЂРІРёСЃРѕРІ, РІ С€Р°Р±Р»РѕРЅРµ 
\templates\РІР°С€_С€Р°Р±Р»РѕРЅ\plugins\comments\comments.show.tpl СЃС‚Р°РЅРѕРІРёС‚СЃСЏ РґРѕСЃС‚СѓРїРЅР° РїРµСЂРµРјРµРЅРЅР°СЏ loginza_icon, 
СЏРІР»СЏСЋС‰Р°СЏСЃСЏ РїРёРєС‚РѕРіСЂР°РјРјРѕР№ СЌС‚РѕРіРѕ СЃРµСЂРІРёСЃР°.  Р’ С„Р°Р№Р»Рµ providers.ini СѓР¶Рµ РїСЂРѕРїРёСЃР°РЅС‹ РІСЃРµ РѕСЃРЅРѕРІРЅС‹Рµ 
СЃРµСЂРІРёСЃС‹ РІ С„РѕСЂРјР°С‚Рµ РґРѕРјРµРЅ = РёРјСЏ_РєР°СЂС‚РёРЅРєРё. Р•РіРѕ РјРѕР¶РЅРѕ РґРѕРїРѕР»РЅСЏС‚СЊ РЅР° СЃРІРѕР№ РІРєСѓСЃ.

#=====================================#
Р�РЅС‚РµРіСЂР°С†РёСЏ СЃ РїСЂРѕС„РёР»РµРј (РїР»Р°РіРёРЅ uprofile)
#=====================================#

Р’ С€Р°Р±Р»РѕРЅРµ \templates\РІР°С€_С€Р°Р±Р»РѕРЅ\plugins\uprofile\users.tpl РґРѕСЃС‚СѓРїРЅР° РїРµСЂРµРјРµРЅРЅР°СЏ loginza_account, 
СЏРІР»СЏСЋС‰Р°СЏСЃСЏ СЃСЃС‹Р»РєРѕР№ РЅР° РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ.

РўР°РєР¶Рµ РµСЃС‚СЊ СѓСЃР»РѕРІРЅС‹Р№ Р±Р»РѕРє if-loginza, СЃРѕРґРµСЂР¶РёРјРѕРµ РєРѕС‚РѕСЂРѕРіРѕ РѕС‚РѕР±СЂР°Р¶Р°РµС‚СЃСЏ С‚РѕР»СЊРєРѕ РІ СЃР»СѓС‡Р°Рµ РЅР°Р»РёС‡РёСЏ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂР°.

Р’ С€Р°Р±Р»РѕРЅРµ \templates\РІР°С€_С€Р°Р±Р»РѕРЅ\plugins\uprofile\profile.tpl РґРѕСЃС‚СѓРїРЅР° РїРµСЂРµРјРµРЅРЅР°СЏ loginza_account, 
СЏРІР»СЏСЋС‰Р°СЏСЃСЏ СЃСЃС‹Р»РєРѕР№ РЅР° РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ.

РўР°РєР¶Рµ РµСЃС‚СЊ СѓСЃР»РѕРІРЅС‹Рµ Р±Р»РѕРєРё:
* if-loginza, СЃРѕРґРµСЂР¶РёРјРѕРµ РєРѕС‚РѕСЂРѕРіРѕ РѕС‚РѕР±СЂР°Р¶Р°РµС‚СЃСЏ С‚РѕР»СЊРєРѕ РІ СЃР»СѓС‡Р°Рµ РЅР°Р»РёС‡РёСЏ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂР°/
  Р’ СЌС‚РѕС‚ Р±Р»РѕРє СѓРґРѕР±РЅРѕ Р±СЂР°С‚СЊ СЃСЃС‹Р»РєСѓ РЅР° СѓРґР°Р»РµРЅРёРµ РїСЂРёРІСЏР·Р°РЅРЅРѕРіРѕ Р°РєРєР°СѓРЅС‚Р°. РћРЅР° РёРјРµРµС‚ РІРёРґ
  /plugin/auth_loginza/delete/ Р�Р»Рё РЅР° РёР·РјРµРЅРµРЅРёРµ Р°РєРєР°СѓРЅС‚Р°, СЃСЃС‹Р»РєР° РёРґРµРЅС‚РёС‡РЅР° СЃСЃС‹Р»РєРµ
  РґР»СЏ Р°РІС‚РѕСЂРёР·Р°С†РёРё
 
* if-not-loginza - РІ СЃР»СѓС‡Р°Рµ РѕС‚СЃСѓС‚СЃС‚РІРёСЏ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂР°. Р’ СЌС‚РѕС‚ Р±Р»РѕРє СѓРґРѕР±РЅРѕ Р±СЂР°С‚СЊ СЃСЃС‹Р»РєСѓ 
  РЅР° РІС…РѕРґ РїРѕ Р°РЅР°Р»РѕРіРёРё СЃ usermenu.tpl. Р•СЃР»Рё С‚Р°РєРѕР№ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ СѓРЅРёРєР°Р»РµРЅ РЅР° СЃР°Р№С‚Рµ, С‚Рѕ
  РґР°РµРј Р·РµР»РµРЅС‹Р№ СЃРІРµС‚, РїСЂРёРІСЏР·С‹РІР°РµРј Р°РєРєР°СѓРЅС‚ Рё РїРѕРєР°Р·С‹РІР°РµРј СЃРѕРґРµСЂР¶РёРјРѕРµ append.account.tpl
  Р•СЃР»Рё РєС‚Рѕ-С‚Рѕ СѓР¶Рµ Р·Р°СЂРµРіРёСЃС‚СЂРёСЂРѕРІР°Р»СЃСЏ СЃ СЌС‚РѕР№ СѓС‡РµС‚РЅРѕР№ Р·Р°РїРёСЃРё, С‚Рѕ РїРѕРєР°Р·С‹РІР°РµРј
  append.account.error.tpl